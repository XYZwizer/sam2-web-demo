(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4659:function(e,t,i){Promise.resolve().then(i.bind(i,9461))},9461:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return f}});var n=i(7437),l=i(2265),s=i(5293),a=i(7712),r=i(1994),c=i(3335);function d(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,c.m6)((0,r.W)(t))}let o=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 dark:focus-visible:ring-zinc-300",{variants:{variant:{default:"bg-zinc-900 text-zinc-50 shadow hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90",destructive:"bg-red-500 text-zinc-50 shadow-sm hover:bg-red-500/90 dark:bg-red-900 dark:text-zinc-50 dark:hover:bg-red-900/90",outline:"border border-zinc-200 bg-white shadow-sm hover:bg-zinc-100 hover:text-zinc-900 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",secondary:"bg-zinc-100 text-zinc-900 shadow-sm hover:bg-zinc-100/80 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-800/80",ghost:"hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",link:"text-zinc-900 underline-offset-4 hover:underline dark:text-zinc-50"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),h=l.forwardRef((e,t)=>{let{className:i,variant:l,size:a,asChild:r=!1,...c}=e,h=r?s.g7:"button";return(0,n.jsx)(h,{className:d(o({variant:l,size:a,className:i})),ref:t,...c})});h.displayName="Button";let u=l.forwardRef((e,t)=>{let{className:i,type:l,...s}=e;return(0,n.jsx)("input",{type:l,className:d("flex h-9 w-full rounded-md border border-zinc-200 bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-zinc-950 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm dark:border-zinc-800 dark:file:text-zinc-50 dark:placeholder:text-zinc-400 dark:focus-visible:ring-zinc-300",i),ref:t,...s})});function f(){let[e,t]=(0,l.useState)(null),[i,s]=(0,l.useState)(null),[a,r]=(0,l.useState)([]),[c,d]=(0,l.useState)(null),[o,f]=(0,l.useState)(null),g=(0,l.useRef)(null),x=(0,l.useCallback)(()=>{let e=g.current,t=null==e?void 0:e.getContext("2d");if(e&&t&&i){t.clearRect(0,0,e.width,e.height);let n=new Image;n.onload=()=>{t.drawImage(n,0,0,e.width,e.height),console.log("drawing points"),a.forEach(i=>{console.log("point",i.x,i.y,i.type),t.beginPath(),t.arc(i.x*e.width,i.y*e.height,4,0,2*Math.PI),t.fillStyle="include"===i.type?"green":"red",t.fill()})},n.src=i}},[a,i]);(0,l.useEffect)(()=>{x()},[x]),(0,l.useEffect)(()=>{let e=g.current;e&&o&&(e.width=o.width,e.height=o.height,x())},[o,x]);let m=async()=>{if(!e||0===a.length)return;let t=new FormData;t.append("image",e),t.append("points",JSON.stringify(a));let i=await fetch("/api/segment",{method:"POST",body:t});if(i.ok){let e=await i.blob();d(URL.createObjectURL(e))}};return(0,n.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-between p-24",children:(0,n.jsxs)("div",{className:"z-10 max-w-5xl w-full items-center justify-between font-mono text-sm",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-8",children:"Image Segmentation"}),(0,n.jsx)(u,{type:"file",accept:"image/*",onChange:e=>{var i;let n=null===(i=e.target.files)||void 0===i?void 0:i[0];if(n){t(n);let e=new FileReader;e.onload=e=>{var t;let i=null===(t=e.target)||void 0===t?void 0:t.result;s(i);let n=new Image;n.onload=()=>{f({width:n.width,height:n.height})},n.src=i},e.readAsDataURL(n)}},className:"mb-4"}),(0,n.jsxs)("div",{className:"flex display-block",children:[i&&o&&(0,n.jsx)("div",{className:"relative",children:(0,n.jsx)("canvas",{ref:g,onClick:e=>{let t=g.current;if(console.log(e),t){let i=t.getBoundingClientRect(),n=t.width/i.width,l=t.height/i.height;console.log("scale",n,l),console.log("canvas size",t.width,t.height),console.log("rect size ",i.width,i.height);let s=(e.clientX-i.left)*n/t.width,c=(e.clientY-i.top)*l/t.height;console.log("pos",s,c);let d=a.findIndex(e=>.01>Math.abs(e.x-s)&&.01>Math.abs(e.y-c));if(console.log("existingPointIndex",d),-1!==d){let e=[...a];"include"===e[d].type?e[d].type="exclude":"exclude"===e[d].type&&e.splice(d,1),r(e)}else r([...a,{x:s,y:c,type:"include"}])}},className:"cursor-crosshair max-w-full h-auto",style:{width:"".concat(o.width,"px"),height:"".concat(o.height,"px")}})}),c&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Generated Mask"}),(0,n.jsx)("img",{src:c,alt:"Generated mask",className:"max-w-full h-auto"})]})]}),(0,n.jsxs)("div",{className:"mt-4 flex items-center space-x-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 bg-green-500 rounded-full mr-2"}),(0,n.jsx)("span",{children:"Include"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded-full mr-2"}),(0,n.jsx)("span",{children:"Exclude (click again exclude)"})]})]}),(0,n.jsx)(h,{onClick:m,className:"mt-4",children:"Generate Mask"})]})})}u.displayName="Input"}},function(e){e.O(0,[660,971,117,744],function(){return e(e.s=4659)}),_N_E=e.O()}]);